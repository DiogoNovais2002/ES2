@page "/event-detail-report"
@using Client.Services
@inject ApiService ApiService

<h3 class="mb-4">Relatório de Evento</h3>

@if (_events == null)
{
    <p>Carregando eventos…</p>
}
else
{
    <div class="mb-4">
        <select @onchange="OnEventChanged" class="form-select w-50">
            <option value="">-- selecione um evento --</option>
            @foreach (var ev in _events)
            {
                <option value="@ev.Id">@ev.Name</option>
            }
        </select>
    </div>
}

@if (_detail != null)
{
    <div class="card mb-4 w-75">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">@_detail.Name</h4>
        </div>
        <div class="card-body">
            <dl class="row mb-0">
                <dt class="col-sm-3">Descrição</dt>
                <dd class="col-sm-9">@_detail.Description</dd>

                <dt class="col-sm-3">Local</dt>
                <dd class="col-sm-9">@_detail.Location</dd>

                <dt class="col-sm-3">Início</dt>
                <dd class="col-sm-9">
                    @_detail.EventStartDate.ToString("dd/MM/yyyy HH:mm")
                </dd>

                <dt class="col-sm-3">Fim</dt>
                <dd class="col-sm-9">
                    @_detail.EventEndDate.ToString("dd/MM/yyyy HH:mm")
                </dd>

                <dt class="col-sm-3">Capacidade</dt>
                <dd class="col-sm-9">@_detail.Capacity</dd>

                <dt class="col-sm-3">Categoria</dt>
                <dd class="col-sm-9">@_detail.Category</dd>
            </dl>

            <hr />

            <h5>Métricas</h5>
            <ul class="list-group list-group-flush">
                <li class="list-group-item d-flex justify-content-between">
                    <span>Total de participantes</span>
                    <strong>@_detail.TotalParticipants</strong>
                </li>
                <li class="list-group-item d-flex justify-content-between">
                    <span>Total de atividades</span>
                    <strong>@_detail.TotalActivities</strong>
                </li>
                <li class="list-group-item d-flex justify-content-between">
                    <span>Duração (horas)</span>
                    <strong>@_detail.DurationHours.ToString("F1")</strong>
                </li>
            </ul>
        </div>
    </div>
}

@code {
    private List<ApiService.EventDto>? _events;
    private ApiService.EventDetailReportDto? _detail;

    protected override async Task OnInitializedAsync()
    {
        _events = await ApiService.GetEventsAsync();
    }

    private async Task OnEventChanged(ChangeEventArgs e)
    {
        _detail = null;
        if (int.TryParse(e.Value?.ToString(), out var id))
        {
            _detail = await ApiService.GetRelatorioEventoAsync(id);
        }
    }
}
